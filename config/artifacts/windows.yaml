# Windows specific artifacts.

name: WindowsActiveDesktop
doc: Windows Active Desktop settings and components.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Internet Explorer\Desktop\Components\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Internet Explorer\Desktop\General'
supported_os: [ Windows ]
---
name: WindowsActivitiesCacheDatabase
doc: SQLite database containing the Windows activities cache.
sources:
  - type: FILE
    attributes:
      paths: [ '%%users.localappdata%%\ConnectedDevicesPlatform\L.%%users.username%%\ActivitiesCache.db' ]
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsAlternateShell
doc: Alternate Shell to be run via Userinit.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SafeBoot', value: 'AlternateShell' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SafeBoot\Option', value: 'UseAlternateShell' }
supported_os: [ Windows ]
---
name: WindowsAMCacheHveFile
doc: The AMCache file, stored in the Windows NT Registry file format.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\AppCompat\Programs\Amcache.hve'
        - '%%environ_systemroot%%\AppCompat\Programs\Amcache.hve.LOG1'
        - '%%environ_systemroot%%\AppCompat\Programs\Amcache.hve.LOG2'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsAppCertDLLs
doc: Windows AppCertDLLs persistence.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\AppCertDLLs' ]
supported_os: [ Windows ]
---
name: WindowsAppCompatCache
doc: Windows Application Compatibility Cache
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\AppCompatibility', value: 'AppCompatCache' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\AppCompatCache', value: 'AppCompatCache' }
supported_os: [ Windows ]
---
name: WindowsAppInitDLLs
doc: |
  Windows Application Initial (AppInit) DLLs persistence.

  AppInit DLLs is a mechanism that allows an arbitrary list of DLLs to be loaded
  into each user mode process on the system.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows', value: 'AppInit_DLLs' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows', value: 'AppInit_DLLs' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Windows', value: 'AppInit_DLLs' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows', value: 'AppInit_DLLs' }
supported_os: [ Windows ]
---
name: WindowsApplicationCompatibilityInstalledShimDatabases
doc: |
  Windows Application Compatibility Installed Shim Databases.

  drvmain.sdb, frxmain.sdb, msimain.sdb, pcamain.sdb, and sysmain.sdb are
  shim database files (SDB files) that are provided by Windows, and contain
  many predefined shims that address known application compatibility issues.
  Note that these database files are not signed.

  Windows also supports custom shim database. These are typically installed
  by the sdbinst.exe utility. Note, that shim database files can also exist
  elsewhere in the file system.

  Windows application shims provide a way for the operating system to
  apply patches to executables before they are run, ultimately providing
  a lightweight mechanism for applying hot fixes and making modifications to
  ensure compatibility across the various versions of Windows. This
  functionality can also be leveraged maliciously to change how certain
  programs operate, or to provide capabilities to malware, such as the
  ability to bypass UAC, gain persistence by injecting loading into legitimate
  processes, or avoid detection by disabling anti-virus software.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\AppPatch\drvmain.sdb'
        - '%%environ_systemroot%%\AppPatch\frxmain.sdb'
        - '%%environ_systemroot%%\AppPatch\msimain.sdb'
        - '%%environ_systemroot%%\AppPatch\pcamain.sdb'
        - '%%environ_systemroot%%\AppPatch\sysmain.sdb'
        - '%%environ_systemroot%%\AppPatch\AppPatch64\Custom\*'
        - '%%environ_systemroot%%\AppPatch\Custom\*'
        - '%%environ_systemroot%%\AppPatch\Custom\Custom64\*'
        - '%%environ_systemroot%%\AppPatch\CustomSDB\*'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsApplicationCompatibilityShimDatabaseMappings
doc: |
  Windows Application Compatibility Shim Database Mappings.

  Mappings between the Windows Application Compatibility shim database files and
  the programs that they apply to.

  Windows allows for custom application shims to be installed via the
  sdbinst.exe application. For example a mapping for 'notepad.exe':

  Key: HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\
      AppCompatFlags\Custom\notepad.exe
  Value: {00000000-1111-2222-3333-444444444444}.sdb = 0

  Key: AppCompatFlags\InstalledSDB\{00000000-1111-2222-3333-444444444444}
  Value: DatabasePath =
      "C:\Windows\AppPatch\Custom\{00000000-1111-2222-3333-444444444444}.sdb"

  Windows application shims provide a way for the operating system to
  apply patches to executables before they are run, ultimately providing
  a lightweight mechanism for applying hot fixes and making modifications to
  ensure compatibility across the various versions of Windows. This
  functionality can also be leveraged maliciously to change how certain
  programs operate, or to provide capabilities to malware, such as the
  ability to bypass UAC, gain persistence by injecting loading into legitimate
  processes, or avoid detection by disabling anti-virus software.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB\*', value: 'DatabaseDescription' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB\*', value: 'DatabasePath' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom\*', value: '*' }
supported_os: [ Windows ]
---
name: WindowsApplicationCompatibilityShims
doc: Windows Application Compatibility Shim Database Files and Application Mappings
sources:
  - type: ARTIFACT_GROUP
    attributes:
      names:
        - 'WindowsApplicationCompatibilityInstalledShimDatabases'
        - 'WindowsApplicationCompatibilityShimDatabaseMappings'
supported_os: [ Windows ]
---
name: WindowsBootVerificationProgram
doc: Path to custom startup verification program.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\BootVerificationProgram', value: 'ImagePath' } ]
supported_os: [ Windows ]
---
name: WindowsComputerName
doc: The name of the system.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\ComputerName\ComputerName', value: 'ComputerName' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\ComputerName\ActiveComputerName', value: 'ComputerName' }
supported_os: [ Windows ]
---
name: WindowsCommandProcessorAutoRun
doc: Commands that are run each time the Command Processor (Cmd.exe) is started.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Command Processor', value: 'AutoRun' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Command Processor', value: 'AutoRun' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Command Processor', value: 'AutoRun' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Command Processor', value: 'AutoRun' }
supported_os: [ Windows ]
---
name: WindowsCOMProperties
doc: |
  Various properties of Windows COM Objects.

  These artifacts are meant to highlight properties of COM objects that,
  although legitimate, are known to be associated with persistence techniques
  or other capabilities that malware can leverage.

  ShellFolder\HideOnDesktop, ShellFolder\Attributes (specifically with value
  0xf090013d), and InprocServer\LoadWithoutCOM are associated with a technique
  to cause iexplore or explorer to load a malicious DLL by registering a COM
  object and invoking it through the use of Junction Folders.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\CLSID\*\ShellFolder', value: 'Attributes' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\CLSID\*\ShellFolder', value: 'Attributes' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\CLSID\*\ShellFolder', value: 'Attributes' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\CLSID\*\ShellFolder', value: 'Attributes' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\CLSID\*\ShellFolder', value: 'HideOnDesktop' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\CLSID\*\ShellFolder', value: 'HideOnDesktop' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\CLSID\*\ShellFolder', value: 'HideOnDesktop' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\CLSID\*\ShellFolder', value: 'HideOnDesktop' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\CLSID\*\InprocServer32', value: 'LoadWithoutCOM' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\CLSID\*\InprocServer32', value: 'LoadWithoutCOM' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\CLSID\*\InprocServer32', value: 'LoadWithoutCOM' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\CLSID\*\InprocServer32', value: 'LoadWithoutCOM' }
supported_os: [ Windows ]
---
name: WindowsSearchFilterHandlers
doc: |
  Windows Search filter handlers configured for file types and applications.

  Windows Search loads DLLs that implement the IFilter interface in order to
  scan files for text and extract certain types of information. Malware can
  replace the filter handler for a given file type or CLSID with itself to gain
  execution when a search operation is performed on that file. Search
  operations can be performed indirectly in a number of cases; for instance,
  the .txt, .html, and .rtf filter handlers are invoked when indexing email
  message bodies.

  The filter handler to use is specified indirectly via a persistent handler.
  The persistent handler GUID is indicated via the PersistentHandler subkey for
  a file type or application GUID.  The filter handler CLSID is indicated via
  the PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF} subkey
  under the persistent handler GUID key path. This artifact inspects both of
  these paths.

  NOTE: Only the HKEY_LOCAL_MACHINE root key needs be checked, because these
  are the only keys used. SearchFilterHost.exe runs under the SYSTEM account,
  which does not have access to HKEY_CURRENT_USER.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\*\PersistentHandler', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\*\PersistentHandler', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\CLSID\*\PersistentHandler', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\CLSID\*\PersistentHandler', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\CLSID\*\PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF}', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\CLSID\*\PersistentAddinsRegistered\{89BCB740-6119-101A-BCB7-00DD010655AF}', value: '' }
supported_os: [ Windows ]
---
name: WindowsCredentialProviderFilters
doc: Windows Credential Provider Filters
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider Filters\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Authentication\Credential Provider Filters\*'
supported_os: [ Windows ]
---
name: WindowsCredentialProviders
doc: CLSIDs of applications to use as Credential Providers
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers\*'
supported_os: [ Windows ]
---
name: WindowsDebugger
doc: Windows Debugger peristence or AV disable.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\*', value: 'Debugger' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\*', value: 'Debugger' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\*', value: 'Debugger' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\*', value: 'Debugger' }
supported_os: [ Windows ]
---
name: WindowsEnvironmentUserLoginScripts
doc: User login scripts configured via Windows environment variables.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Environment', value: 'UserInitLogonServer' }
        - { key: 'HKEY_USERS\%%users.sid%%\Environment', value: 'UserInitLogonScript' }
        - { key: 'HKEY_USERS\%%users.sid%%\Environment', value: 'UserInitMprLogonScript' }
supported_os: [ Windows ]
---
name: WindowsEnvironmentVariableAllUsersProfile
doc: The system-wide %AllUsersProfile% environment variable contains the path of the of the "All Users" or "Common" profile directory.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\ProfileList', value: 'AllUsersProfile' }
    provides:
      - key: environ_allusersappdata
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\ProfileList', value: 'ProgramData' }
    provides:
      - key: environ_allusersappdata
  - type: PATH
    attributes:
      paths:
        - '\ProgramData'
        - '\Documents and Settings\All Users'
      separator: '\'
    provides:
      - key: environ_allusersappdata
supported_os: [ Windows ]
---
name: WindowsEnvironmentVariableProfilesDirectory
doc: The %ProfilesDirectory% environment variable contain a path of a directory that contains the users' profile directories, typically "%SystemDrive%\Users".
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\ProfileList', value: 'ProfilesDirectory' }
    provides:
      - key: environ_profilesdirectory
supported_os: [ Windows ]
---
name: WindowsEnvironmentVariableSystemRoot
doc: The %SystemRoot%, environment variable contains the path of the system directory, typically "C:\Windows".
sources:
  - type: PATH
    attributes:
      paths:
        - '\Windows'
        - '\WinNT'
        - '\WINNT35'
        - '\WTSRV'
      separator: '\'
    provides:
      - key: environ_systemroot
      - key: environ_systemdrive
        regex: '^(..)'
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion', value: 'SystemRoot' }
    provides:
      - key: environ_systemroot
      - key: environ_systemdrive
        regex: '^(..)'
supported_os: [ Windows ]
---
name: WindowsExplorerAutoplayHandlers
doc: Handlers for autoplay events in Windows Explorer.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\AutoplayHandlers\Handlers\*' ]
supported_os: [ Windows ]
---
name: WindowsFileTypeAutorunAssociations
doc: |
  Registry value for what application class identifier (CLSID) to launch for a file extension.

  Extension subkeys start with a dot. The '(Default)' value will be a ProgID,
  which points to another entry in HKCR specifying the command to run to open
  a file of the given type. The WindowsShellOpenCommand artifact is associated
  with these ProgID command invocations.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\.*', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\.*', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\.*', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\.*', value: '' }
supported_os: [ Windows ]
---
name: WindowsGroupPolicyScripts
doc: Windows group policy scripts
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\System32\GroupPolicy\User\Scripts\psscripts.ini'
        - '%%environ_systemroot%%\System32\GroupPolicy\User\Scripts\scripts.ini'
        - '%%environ_systemroot%%\System32\GroupPolicy\User\Scripts\Logoff\*'
        - '%%environ_systemroot%%\System32\GroupPolicy\User\Scripts\Logon\*'
        - '%%environ_systemroot%%\System32\GroupPolicy\Machine\Scripts\psscripts.ini'
        - '%%environ_systemroot%%\System32\GroupPolicy\Machine\Scripts\scripts.ini'
        - '%%environ_systemroot%%\System32\GroupPolicy\Machine\Scripts\Shutdown\*'
        - '%%environ_systemroot%%\System32\GroupPolicy\Machine\Scripts\Startup\*'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsLogoffScript
doc: Windows policy logoff script
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Policies\Microsoft\Windows\System\Scripts', value: 'Logoff' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\System\Scripts', value: 'Logoff' }
supported_os: [ Windows ]
---
name: WindowsLogonScript
doc: Windows policy logon script
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Policies\Microsoft\Windows\System\Scripts', value: 'Logon' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\System\Scripts', value: 'Logon' }
supported_os: [ Windows ]
---
name: WindowsLSAAuthenticationPackages
doc: Authentication Packages can be injected into LSASS.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa', value: 'Authentication Packages' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa\OSConfig', value: 'Authentication Packages' }
supported_os: [ Windows ]
---
name: WindowsLSANotificationPackages
doc: Notification Packages can be injected into LSASS.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa', value: 'Notification Packages' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa\OSConfig', value: 'Notification Packages' }
supported_os: [ Windows ]
---
name: WindowsLSASecurityPackages
doc: Security Packages can be injected into LSASS.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa', value: 'Security Packages' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Lsa\OSConfig', value: 'Security Packages' }
supported_os: [ Windows ]
---
name: WindowsMostRecentApplication
doc: Windows Most Recent Application name key
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\*\MostRecentApplication', value: 'Name' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\*\MostRecentApplication', value: 'Name' }
supported_os: [ Windows ]
---
name: WindowsMSDTCDLLs
doc: Windows MSDTC attempts to load these DLLs on start
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\MSDTC\MTxOCI\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\MSDTC\MTxOCI\*'
supported_os: [ Windows ]
---
name: WindowsMultiMediaDrivers
doc: Configured drivers for different multimedia filetypes.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Drivers32\*'
        - 'HKEY_USERS\%%users.sid%%\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Drivers32\*'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32\*'
        - 'HKEY_USERS\%%users.sid%%\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Drivers32\*'
supported_os: [ Windows ]
---
name: WindowsNetworkShellHelpers
doc: Windows Network Shell (netsh) helpers are loaded on boot
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Netsh'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Netsh'
supported_os: [ Windows ]
---
name: WindowsOpenSaveMRU
doc: Information about files opened or saved in a Windows shell dialog.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDIg32\OpenSaveMRU\*' ]
supported_os: [ Windows ]
---
name: WindowsOpenSavePidlMRU
doc: Information about files opened or saved in a Windows shell dialog.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePidlMRU\*' ]
supported_os: [ Windows ]
---
name: WindowsPendingGPOs
doc: |
  Windows Pending GPOs registry settings.

  This is a persistence mechanism known to be used by the Gootkit malware family.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\IEAK\GroupPolicy\PendingGPOs', value: 'Path1' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\IEAK\GroupPolicy\PendingGPOs', value: 'Path1' }
supported_os: [ Windows ]
---
name: WindowsPersistenceMechanisms
doc: Persistence mechanisms in Windows.
sources:
  - type: ARTIFACT_GROUP
    attributes:
      names:
        - WindowsPersistenceRegistryKeys
        - WindowsPowerShellDefaultProfiles
        - WindowsServices
        - WindowsJobFiles
supported_os: [ Windows ]
---
name: WindowsPersistenceRegistryKeys
doc: Windows Registry keys used for persistence.
sources:
  - type: ARTIFACT_GROUP
    attributes:
      names:
        - InternetExplorerBrowserHelperObjectsRegistryKeys
        - WindowsActiveDesktop
        - WindowsActiveSyncAutoStart
        - WindowsAlternateShell
        - WindowsAppCertDLLs
        - WindowsAppInitDLLs
        - WindowsBootVerificationProgram
        - WindowsCommandProcessorAutoRun
        - WindowsCredentialProviderFilters
        - WindowsCredentialProviders
        - WindowsDebugger
        - WindowsEnvironmentUserLoginScripts
        - WindowsExplorerAutoplayHandlers
        - WindowsFileTypeAutorunAssociations
        - WindowsFontDrivers
        - WindowsIconServiceLib
        - WindowsLSAAuthenticationPackages
        - WindowsLSANotificationPackages
        - WindowsLSASecurityPackages
        - WindowsMSDTCDLLs
        - WindowsMultiMediaDrivers
        - WindowsNetworkShellHelpers
        - WindowsPendingGPOs
        - WindowsPLAPProviders
        - WindowsPrintMonitors
        - WindowsRunGrpConv
        - WindowsRunKeys
        - WindowsRunServices
        - WindowsScreenSaverExecutable
        - WindowsSearchFilterHandlers
        - WindowsSecurityProviders
        - WindowsServiceControlManagerExtension
        - WindowsSessionManagerBootExecute
        - WindowsSessionManagerExecute
        - WindowsSessionManagerS0InitialCommand
        - WindowsSessionManagerSetupExecute
        - WindowsSessionManagerSubSystems
        - WindowsSessionManagerWOWCommandLine
        - WindowsSetupCommandLine
        - WindowsSharedTaskScheduler
        - WindowsShellExecuteHooks
        - WindowsShellExtensions
        - WindowsShellIconOverlayIdentifiers
        - WindowsShellLoadAndRun
        - WindowsShellOpenCommand
        - WindowsShellRunasCommand
        - WindowsShellServiceObjects
        - WindowsStubPaths
        - WindowsSystemPolicyShell
        - WindowsTerminalServerInitialProgram
        - WindowsTerminalServerRunKeys
        - WindowsTerminalServerStartupPrograms
        - WindowsToolPaths
        - WindowsWinlogonAppSetup
        - WindowsWinlogonAvailableShells
        - WindowsWinlogonGinaDLL
        - WindowsWinlogonGPExtensions
        - WindowsWinlogonNotify
        - WindowsWinlogonShell
        - WindowsWinlogonSystem
        - WindowsWinlogonTaskman
        - WindowsWinlogonUiHost
        - WindowsWinlogonUserinit
        - WindowsWinlogonVMApplet
        - WinSock2LayeredServiceProviders
        - WinSock2NamespaceProviders
supported_os: [ Windows ]
---
name: WindowsPLAPProviders
doc: Windows Pre-Logon Access Provider (PLAP) Providers
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Authentication\PLAP Providers\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Authentication\PLAP Providers\*'
supported_os: [ Windows ]
---
name: WindowsPowerShellDefaultProfiles
doc: Default PowerShell Profile files. These files are executed by default when PowerShell starts up.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\system32\WindowsPowerShell\v1.0\profile.ps1'
        - '%%environ_systemroot%%\system32\WindowsPowerShell\v1.0\Microsoft.PowerShell_profile.ps1'
        - '%%users.userprofile%%\Documents\WindowsPowerShell\profile.ps1'
        - '%%users.userprofile%%\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsPrefetchFiles
doc: Windows Prefetch files.
sources:
  - type: FILE
    attributes:
      paths: [ '%%environ_systemroot%%\Prefetch\*.pf' ]
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsPrintMonitors
doc: Windows Print Monitor DLL config.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Print\Monitors\*', value: 'Driver' } ]
supported_os: [ Windows ]
---
name: WindowsRecycleBin
doc: Windows Recycle Bin (Recyler, $Recycle.Bin) files.
sources:
  - type: FILE
    attributes:
      paths:
        - '\$Recycle.Bin\**'
        - '\Recycler\**'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsRegistryProfileSIDs
doc: Get SIDs for all users on the system with profiles present in the Registry.
sources:
  - type: REGISTRY_KEY
    attributes: { keys: [ 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\ProfileList\*' ] }
    provides:
      - key: users.sid
        regex: 'ProfileList\\(.+)$'
supported_os: [ Windows ]
---
name: WindowsRegistryProfiles
doc: |
  Get SIDs for all users on the system with profiles present in the Registry.

  This looks in the Windows Registry where the profiles are stored and retrieves
  the paths for each profile.
sources:
  - type: REGISTRY_VALUE
    attributes: { key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\ProfileList\*', value: 'ProfileImagePath' } ] }
    provides:
      - key: users.userprofile
      - key: users.username
        regex: '.*\\(.+)'
supported_os: [ Windows ]
---
name: WindowsRunGrpConv
doc: |
  The Windows RunGrpConv Registry value.

  When this Registry value is non-zero userinit.exe will launch grpconv.exe at user login.
sources:
  - type: REGISTRY_VALUE
    attributes: { key_value_pairs: [ { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'RunGrpConv' } ] }
supported_os: [ Windows ]
---
name: WindowsRunKeys
doc: |
  Windows Run and RunOnce keys.

  Note users.sid will currently only expand to SIDs with profiles
  on the system, not all SIDs.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce\Setup'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce\Setup'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnceEx'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Run'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\RunOnce'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\RunOnce\Setup'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\RunOnceEx'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Run'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnce\Setup'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunOnceEx'
supported_os: [ Windows ]
---
name: WindowsRunServices
doc: Windows Run Services.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\RunServices'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServicesOnce'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\RunServices'
supported_os: [ Windows ]
---
name: WindowsScheduledTasks
doc: Windows Scheduled Tasks.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\Tasks\**10'
        - '%%environ_systemroot%%\System32\Tasks\**10'
        - '%%environ_systemroot%%\SysWow64\Tasks\**10'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsScreenSaverExecutable
doc: ScreenSaver Executable
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Policies\Microsoft\Windows\Control Panel\Desktop', value: 'scrnsave.exe' }
        - { key: 'HKEY_USERS\%%users.sid%%\Control Panel\Desktop', value: 'scrnsave.exe' }
supported_os: [ Windows ]
---
name: WindowsSecurityProviders
doc: Security Providers DLLs
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders' ]
supported_os: [ Windows ]
---
name: WindowsServiceControlManagerExtension
doc: Windows service control manager extension
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control', value: 'ServiceControlManagerExtension' } ]
supported_os: [ Windows ]
---
name: WindowsServices
doc: |
  Windows services from the Registry.

  Malware can add new services to gain persistence, or modify
  existing ones to avoid detection. For example, the ZeroAccess
  rootkit will make the following changes to the WSCSVC (Windows
  Security Service Center), WINDEFEND (Windows Defender),
  and MPSSVC (Windows Firewall) services, among others

  * Set 'Start' to 4, indicating that the service should be disabled
  * Set 'DeleteFlag' to 1, indicating that the service should be removed
  * Set 'ErrorControl' to 0 and 'Type' to 32, causing it to fail to be
    started by the Service Controller and no error messages generated
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\*'
        - 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\*\Parameters'
supported_os: [ Windows ]
---
name: WindowsFontDrivers
doc: Windows font drivers from the Registry.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Font Drivers\*'
supported_os: [ Windows ]
---
name: WindowsSessionManagerBootExecute
doc: Windows Session Manager BootExecute persistence.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager', value: 'BootExecute' } ]
supported_os: [ Windows ]
---
name: WindowsSessionManagerExecute
doc: |
  Windows Session Manager Execute persistence

  This entry shouldn't be populated after Windows has been installed
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager', value: 'Execute' } ]
supported_os: [ Windows ]
---
name: WindowsSessionManagerS0InitialCommand
doc: |
  Windows Session Manager S0InitialCommand persistence

  This entry shouldn't be populated after Windows has been installed
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager', value: 'S0InitialCommand' } ]
supported_os: [ Windows ]
---
name: WindowsSessionManagerSetupExecute
doc: |
  Windows Session Manager SetupExecute persistence

  This entry shouldn't be populated after Windows has been installed
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager', value: 'SetupExecute' } ]
supported_os: [ Windows ]
---
name: WindowsSessionManagerSubSystems
doc: Windows Session Manager SubSystems persistence
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs: [ { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\SubSystems', value: 'Windows' } ]
supported_os: [ Windows ]
---
name: WindowsSessionManagerWOWCommandLine
doc: Windows Session Manager Windows-on-Windows (WOW) command line
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\WOW', value: 'cmdline' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\WOW', value: 'wowcmdline' }
supported_os: [ Windows ]
---
name: WindowsSetupCommandLine
doc: Command line invocation used for custom setup and deployment tasks
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\Setup', value: 'CmdLine' }
supported_os: [ Windows ]
---
name: WindowsSharedTaskScheduler
doc: Runs on windows boot.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\SharedTaskScheduler\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\SharedTaskScheduler\*'
supported_os: [ Windows ]
---
name: WindowsShellExecuteHooks
doc: Shell execution hooks are called when ShellExecuteEx() is called.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellExecuteHooks'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellExecuteHooks'
supported_os: [ Windows ]
---
name: WindowsShellExtensions
doc: Approved extensions to the Windows Shell (explorer.exe).
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Approved'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Shell Extensions\Approved'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Shell Extensions\Approved'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Shell Extensions\Approved'
supported_os: [ Windows ]
---
name: WindowsShellIconOverlayIdentifiers
doc: Called to display custom icons.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Explorer\ShellIconOverlayIdentifiers\*'
supported_os: [ Windows ]
---
name: WindowsShellLoadAndRun
doc: Windows Shell Load and Run values
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Windows', value: 'Load' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Windows', value: 'Run' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows', value: 'Load' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows', value: 'Run' }
supported_os: [ Windows ]
---
name: WindowsIconServiceLib
doc: |
  Windows Icon Service Library Name

  The value should default to 'IconCodecService.dll'
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows', value: 'IconServiceLib' }
supported_os: [ Windows ]
---
name: WindowsShellOpenCommand
doc: Executed every time this file type is opened. For most file types, the value should be '"%1" %*'.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\*\shell\open\command', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\*\shell\open\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\*\shell\open\command', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\*\shell\open\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\*\shell\open\command', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\*\shell\open\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\*\shell\open\command', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\*\shell\open\command', value: 'IsolatedCommand' }
supported_os: [ Windows ]
---
name: WindowsShellRunasCommand
doc: |
  Executed every time an executable or script file type is run as administrator.

  For most file types, the value should be '"%1" %*' or something similar.
  Example file type subkeys include 'exefile', 'batfile', and 'cmdfile'. These
  keys can be modified by malware as a way to be periodically executed or to
  bypass UAC.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\*\shell\runas\command', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\*\shell\runas\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\*\shell\runas\command', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Classes\Wow6432Node\*\shell\runas\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\*\shell\runas\command', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\*\shell\runas\command', value: 'IsolatedCommand' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\*\shell\runas\command', value: '' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Classes\Wow6432Node\*\shell\runas\command', value: 'IsolatedCommand' }
supported_os: [ Windows ]
---
name: WindowsShellServiceObjects
doc: Windows Shell (explorer.exe) service objects delayed load.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\ShellServiceObjectDelayLoad'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\ShellServiceObjectDelayLoad'
supported_os: [ Windows ]
---
name: WindowsSetupApiLogs
doc: Windows setup API logs.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\setupapi.log'
        - '%%environ_systemroot%%\inf\setupapi.app.log'
        - '%%environ_systemroot%%\inf\setupapi.dev.log'
        - '%%environ_systemroot%%\inf\setupapi.offline.log'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsStartupFolders
doc: Windows startup folder persistence.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_allusersappdata%%\Microsoft\Windows\Start Menu\Programs\Startup\*'
        - '%%environ_allusersappdata%%\Start Menu\Programs\Startup\*'
        - '%%users.appdata%%\Microsoft\Windows\Start Menu\Programs\Startup\*'
        - '%%users.userprofile%%\Start Menu\Programs\Startup\*'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsStartupScript
doc: Windows policy startup script
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\System\Scripts', value: 'Startup' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\*\*', value: 'Script' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\Scripts\Startup\*\*', value: 'Parameters' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Startup\*\*', value: 'Script' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Group Policy\State\Machine\Scripts\Startup\*\*', value: 'Parameters' }
supported_os: [ Windows ]
---
name: WindowsStubPaths
doc: |
  Windows StubPath persistence.

  Each time a user logs in, the Active Setup Installed Components in HKLM
  are compared ot the ones in HKCU, and if any are missing, or if the
  associated version is less, the program is executed.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Active Setup\Installed Components\*', value: 'StubPath' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Active Setup\Installed Components\*', value: 'Version' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Active Setup\Installed Components\*', value: 'StubPath' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Active Setup\Installed Components\*', value: 'Version' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Active Setup\Installed Components\*', value: 'StubPath' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Active Setup\Installed Components\*', value: 'Version' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Active Setup\Installed Components\*', value: 'StubPath' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Active Setup\Installed Components\*', value: 'Version' }
supported_os: [ Windows ]
---
name: WindowsSystemPolicyShell
doc: Windows System policy replacement shell (custom user interface).
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Policies\System', value: 'Shell' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Policies\System', value: 'Shell' }
supported_os: [ Windows ]
---
name: WindowsSystemRegistryFiles
doc: Windows system Registry files.
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemdrive%%\System Volume Information\Syscache.hve'
        - '%%environ_systemroot%%\System32\config\SAM'
        - '%%environ_systemroot%%\System32\config\SECURITY'
        - '%%environ_systemroot%%\System32\config\SOFTWARE'
        - '%%environ_systemroot%%\System32\config\SYSTEM'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsSystemResourceUsageMonitorDatabaseFile
doc: Windows System Resource Usage Monitor (SRUM) database file.
sources:
  - type: FILE
    attributes:
      paths: [ '%%environ_systemroot%%\System32\sru\SRUDB.dat' ]
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsTerminalServerRunKeys
doc: Windows Terminal Server Run keys
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Runonce\*'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunonceEx\*'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Runonce\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunonceEx\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Runonce\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunonceEx\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Runonce\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\RunonceEx\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Terminal Server\Install\Software\Microsoft\Windows\CurrentVersion\Run\*'
supported_os: [ Windows ]
---
name: WindowsTerminalServerStartupPrograms
doc: Windows Terminal Server Startup Programs
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\Wds\rdpwd', value: 'StartupPrograms' }
supported_os: [ Windows ]
---
name: WindowsTerminalServerInitialProgram
doc: Windows Terminal Server Initial Program
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp', value: 'InitialProgram' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows NT\Terminal Services', value: 'InitialProgram' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Policies\Microsoft\Windows NT\Terminal Services', value: 'InitialProgram' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Policies\Microsoft\Windows NT\Terminal Services', value: 'InitialProgram' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Wow6432Node\Policies\Microsoft\Windows NT\Terminal Services', value: 'InitialProgram' }
supported_os: [ Windows ]
---
name: WindowsActiveSyncAutoStart
doc: Windows ActiveSync AutoStart entries
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows CE Services\AutoStartOnConnect\*'
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows CE Services\AutoStartOnDisconnect\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows CE Services\AutoStartOnConnect\*'
        - 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows CE Services\AutoStartOnDisconnect\*'
supported_os: [ Windows ]
---
name: WindowsTimezone
doc: The time zone of the system as a Windows time zone name or in MUI form.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\TimeZoneInformation', value: 'StandardName' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\TimeZoneInformation', value: 'TimeZoneKeyName' }
supported_os: [ Windows ]
---
name: WindowsToolPaths
doc: Paths to windows tools such as defrag, chkdsk.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\BackupPath'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\ChkDskPath'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\cleanuppath'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\MyComputer\DefragPath'
supported_os: [ Windows ]
---
name: WindowsUninstallKeys
doc: Uninstall Registry keys
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall\*'
        - 'HKEY_LOCAL_MACHINE\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*'
        - 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Uninstall\*'
supported_os: [ Windows ]
---
name: WindowsUserShellFoldersOfInterest
doc: The Shell Folders information for Windows users, defined as single values for knowledge base extraction
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders', value: 'AppData' }
    provides: [ { key: users.appdata } ]
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders', value: 'Local AppData' }
    provides: [ { key: users.localappdata } ]
supported_os: [ Windows ]
---
name: WindowsWinlogonGinaDLL
doc: Windows Gina DLL replacement.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'GinaDLL' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'GinaDLL' }
supported_os: [ Windows ]
---
name: WindowsWinlogonNotify
doc: Windows Winlogon Notify DLL names.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\*', value: 'DLLName' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\*', value: 'DLLName' }
supported_os: [ Windows ]
---
name: WindowsWinlogonShell
doc: Windows shell replacement.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Shell' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Shell' }
supported_os: [ Windows ]
---
name: WindowsWinlogonSystem
doc: Applications launched by Winlogon in the system context during the system initialisation.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'System' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'System' }
supported_os: [ Windows ]
---
name: WindowsWinlogonTaskman
doc: Windows Winlogon Taskman replacement.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Taskman' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Taskman' }
supported_os: [ Windows ]
---
name: WindowsWinlogonUiHost
doc: Windows Winlogon UI screen application
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'UiHost' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'UiHost' }
supported_os: [ Windows ]
---
name: WindowsWinlogonUserinit
doc: Windows Winlogon Userinit replacement.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Userinit' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'Userinit' }
supported_os: [ Windows ]
---
name: WindowsWinlogonAvailableShells
doc: |
  Windows Server Winlogon Available Shells

  Used to specify an alternate shell application to be launched when
  logging into Windows Server 2012 and later. Legitimate keys under
  AvailableShells should just cause cmd.exe or explorer.exe to be executed,
  whereas malicious programs may create keys that cause malware to be run
  when a user logs in.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys: [ 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\AlternateShells\AvailableShells\*' ]
supported_os: [ Windows ]
---
name: WindowsWinlogonVMApplet
doc: Windows VMApplet replacement.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'VMApplet' }
        - { key: 'HKEY_USERS\%%users.sid%%\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'VMApplet' }
supported_os: [ Windows ]
---
name: WindowsWinlogonAppSetup
doc: Windows Winlogon Appsetup
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon', value: 'AppSetup' }
supported_os: [ Windows ]
---
name: WindowsWinlogonGPExtensions
doc: |
  Windows Winlogon Group Policy Extensions

  These keys specify DLLs that should be loaded when the group policy
  engine loads, and can act as a persistence mechanism for malware.
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\*', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\*', value: 'DllName' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\*', value: '' }
        - { key: 'HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\*', value: 'DllName' }
supported_os: [ Windows ]
---
name: WinSock2LayeredServiceProviders
doc: Used to filter TCP/IP traffic through WinSock2.
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\WinSock2\Parameters\Protocol_Catalog9\Catalog_Entries\*'
        - 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\WinSock2\Parameters\Protocol_Catalog9\Catalog_Entries64\*'
supported_os: [ Windows ]
---
name: WinSock2NamespaceProviders
doc: Used to provide name-resolution services through WinSock2
sources:
  - type: REGISTRY_VALUE
    attributes:
      key_value_pairs:
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\WinSock2\Parameters\NameSpace_Catalog5\Catalog_Entries\*', value: 'LibraryPath' }
        - { key: 'HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\WinSock2\Parameters\NameSpace_Catalog5\Catalog_Entries64\*', value: 'LibraryPath' }
supported_os: [ Windows ]
---
name: WindowsJobFiles
doc: Files for the Windows Task Scheduler
sources:
  - type: FILE
    attributes:
      paths:
        - '%%environ_systemroot%%\system32\Tasks\**10'
        - '%%environ_systemroot%%\Tasks\**10'
      separator: '\'
supported_os: [ Windows ]
---
name: WindowsNetworkInterfaceInformation
doc: Details for network interfaces and their names
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\SYSTEM\ControlSet*\Services\Tcpip\Parameters\Interfaces\*'
        - 'HKEY_LOCAL_MACHINE\SYSTEM\ControlSet*\Control\Network\{4D36E972-E325-11CE-BFC1-08002BE10318}\*\Connection'
supported_os: [ Windows ]
---
name: WindowsHotfixes
doc: Windows Registry Keys that contain Hotfix information
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Component Based Servicing\Packages\*'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Updates\*\*'
        - 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Updates\*\*'
supported_os: [ Windows ]
---
name: WindowsDefaultPaths
doc: Default Paths for many parameters
sources:
  - type: PATH
    attributes:
      paths:
        - '%%environ_systemdrive%%\Users'
      separator: '\'
    provides: [ { key: environ_profilesdirectory } ]
  - type: PATH
    attributes:
      paths:
        - '%%environ_profilesdirectory%%\*'
        - '\Users\*'
      separator: '\'
    provides:
      - { key: users.userprofile }
      - { key: users.username, regex: '.*\\(.+)' }
  - type: PATH
    attributes:
      paths:
        - '%%environ_profilesdirectory%%\*\AppData\Roaming'
        - '\Users\*\AppData\Roaming'
      separator: '\'
    provides: [ { key: users.appdata } ]
  - type: PATH
    attributes:
      paths:
        - '%%environ_profilesdirectory%%\*\AppData\Local'
        - '\Users\*\AppData\Local'
      separator: '\'
    provides: [ { key: users.localappdata } ]
supported_os: [ Windows ]
---
name: WindowsUserSIDDefaultKeys
doc: Bruteforce SIDs
sources:
  - type: REGISTRY_KEY
    attributes:
      keys:
        - 'HKEY_USERS\*'
    provides: [ { key: users.sid, regex: '.*\\(.+)' } ]
supported_os: [ Windows ]
